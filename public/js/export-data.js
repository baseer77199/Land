!function(e){"object"==typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):e(Highcharts)}(function(e){var t;(t=e).ajax=function(e){var o=t.merge(!0,{url:!1,type:"GET",dataType:"json",success:!1,error:!1,data:!1,headers:{}},e);e={json:"application/json",xml:"application/xml",text:"text/plain",octet:"application/octet-stream"};var n=new XMLHttpRequest;if(!o.url)return!1;n.open(o.type.toUpperCase(),o.url,!0),n.setRequestHeader("Content-Type",e[o.dataType]||e.text),t.objectEach(o.headers,function(e,t){n.setRequestHeader(t,e)}),n.onreadystatechange=function(){var e;if(4===n.readyState){if(200===n.status){if(e=n.responseText,"json"===o.dataType)try{e=JSON.parse(e)}catch(e){return void(o.error&&o.error(n,e))}return o.success&&o.success(e)}o.error&&o.error(n,n.responseText)}};try{o.data=JSON.stringify(o.data)}catch(e){}n.send(o.data||!0)},function(e){var t=e.defined,o=e.each,n=e.pick,a=e.win,i=a.document,r=e.seriesTypes,s=void 0!==i.createElement("a").download;e.setOptions({exporting:{csv:{columnHeaderFormatter:null,dateFormat:"%Y-%m-%d %H:%M:%S",decimalPoint:null,itemDelimiter:null,lineDelimiter:"\n"},showTable:!1,useMultiLevelHeaders:!0,useRowspanHeaders:!0},lang:{downloadCSV:"Download CSV",downloadXLS:"Download XLS",openInCloud:"Open in Highcharts Cloud",viewData:"View data table"}}),e.addEvent(e.Chart,"render",function(){this.options&&this.options.exporting&&this.options.exporting.showTable&&this.viewData()}),e.Chart.prototype.setUpKeyToAxis=function(){r.arearange&&(r.arearange.prototype.keyToAxis={low:"y",high:"y"})},e.Chart.prototype.getDataRows=function(a){var i,r,s,l,p,c,d,h=this.time,u=this.options.exporting&&this.options.exporting.csv||{},m=this.xAxis,x={},f=[],g=[],y=[],v=function(t,o,n){if(u.columnHeaderFormatter){var i=u.columnHeaderFormatter(t,o,n);if(!1!==i)return i}return t?t instanceof e.Axis?t.options.title&&t.options.title.text||(t.isDatetimeAxis?"DateTime":"Category"):a?{columnTitle:1<n?o:t.name,topLevelColumnTitle:t.name}:t.name+(1<n?" ("+o+")":""):"Category"},b=[];l=0,this.setUpKeyToAxis(),o(this.series,function(t){var i,r,p=t.options.keys||t.pointArrayMap||["y"],c=p.length,d=!t.requireSorting&&{},f={},w={},C=e.inArray(t.xAxis,m);if(o(p,function(e){var o=(t.keyToAxis&&t.keyToAxis[e]||e)+"Axis";f[e]=t[o]&&t[o].categories||[],w[e]=t[o]&&t[o].isDatetimeAxis}),!1!==t.options.includeInCSVExport&&!t.options.isInternal&&!1!==t.visible){for(e.find(b,function(e){return e[0]===C})||b.push([C,l]),r=0;r<c;)s=v(t,p[r],p.length),y.push(s.columnTitle||s),a&&g.push(s.topLevelColumnTitle||s),r++;i={chart:t.chart,autoIncrement:t.autoIncrement,options:t.options,pointArrayMap:t.pointArrayMap},o(t.options.data,function(e,o){var a,s;for(s={series:i},t.pointClass.prototype.applyOptions.apply(s,[e]),e=s.x,a=t.data[o]&&t.data[o].name,d&&(d[e]&&(e+="|"+o),d[e]=!0),r=0,t.xAxis&&"name"!==t.exportKey||(e=a),x[e]||(x[e]=[],x[e].xValues=[]),x[e].x=s.x,x[e].name=a,x[e].xValues[C]=s.x;r<c;)o=p[r],a=s[o],x[e][l+r]=n(f[o][a],w[o]?h.dateFormat(u.dateFormat,a):null,a),r++}),l+=r}});for(r in x)x.hasOwnProperty(r)&&f.push(x[r]);for(r=a?[g,y]:[y],l=b.length;l--;)c=b[l][0],d=b[l][1],i=m[c],f.sort(function(e,t){return e.xValues[c]-t.xValues[c]}),p=v(i),r[0].splice(d,0,p),a&&r[1]&&r[1].splice(d,0,p),o(f,function(e){var o=e.name;i&&!t(o)&&(i.isDatetimeAxis?(e.x instanceof Date&&(e.x=e.x.getTime()),o=h.dateFormat(u.dateFormat,e.x)):o=i.categories?n(i.names[e.x],i.categories[e.x],e.x):e.x),e.splice(d,0,o)});return r=r.concat(f),e.fireEvent(this,"exportData",{dataRows:r}),r},e.Chart.prototype.getCSV=function(e){var t="",a=this.getDataRows(),i=this.options.exporting.csv,r=n(i.decimalPoint,","!==i.itemDelimiter&&e?1.1.toLocaleString()[1]:"."),s=n(i.itemDelimiter,","===r?";":","),l=i.lineDelimiter;return o(a,function(e,o){for(var n,i=e.length;i--;)n=e[i],"string"==typeof n&&(n='"'+n+'"'),"number"==typeof n&&"."!==r&&(n=n.toString().replace(".",r)),e[i]=n;t+=e.join(s),o<a.length-1&&(t+=l)}),t},e.Chart.prototype.getTable=function(e){var t="<table>",a=this.options,i=e?1.1.toLocaleString()[1]:".",r=n(a.exporting.useMultiLevelHeaders,!0);e=this.getDataRows(r);var s=0,l=r?e.shift():null,p=e.shift(),c=function(e,t,o,a){var r=n(a,"");return t="text"+(t?" "+t:""),"number"==typeof r?(r=r.toString(),","===i&&(r=r.replace(".",i)),t="number"):a||(t="empty"),"<"+e+(o?" "+o:"")+' class="'+t+'">'+r+"</"+e+">"};!1!==a.exporting.tableCaption&&(t+='<caption class="highcharts-table-caption">'+n(a.exporting.tableCaption,a.title.text?a.title.text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):"Chart")+"</caption>");for(var d=0,h=e.length;d<h;++d)e[d].length>s&&(s=e[d].length);return t+=function(e,t,o){var n="<thead>",i=0;o=o||t&&t.length;var s,l,p=0;if(l=r&&e&&t){e:if(l=e.length,t.length===l){for(;l--;)if(e[l]!==t[l]){l=!1;break e}l=!0}else l=!1;l=!l}if(l){for(n+="<tr>";i<o;++i)l=e[i],s=e[i+1],l===s?++p:p?(n+=c("th","highcharts-table-topheading",'scope="col" colspan="'+(p+1)+'"',l),p=0):(l===t[i]?a.exporting.useRowspanHeaders?(s=2,delete t[i]):(s=1,t[i]=""):s=1,n+=c("th","highcharts-table-topheading",'scope="col"'+(1<s?' valign="top" rowspan="'+s+'"':""),l));n+="</tr>"}if(t){for(n+="<tr>",i=0,o=t.length;i<o;++i)void 0!==t[i]&&(n+=c("th",null,'scope="col"',t[i]));n+="</tr>"}return n+"</thead>"}(l,p,Math.max(s,p.length)),t+="<tbody>",o(e,function(e){t+="<tr>";for(var o=0;o<s;o++)t+=c(o?"td":"th",null,o?"":'scope="row"',e[o]);t+="</tr>"}),t+="</tbody></table>"},e.Chart.prototype.fileDownload=function(t,o,n){var r;r=this.options.exporting.filename?this.options.exporting.filename:this.title&&this.title.textStr?this.title.textStr.replace(/ /g,"-").toLowerCase():"chart",a.Blob&&a.navigator.msSaveOrOpenBlob?(t=new a.Blob(["\ufeff"+n],{type:"text/csv"}),a.navigator.msSaveOrOpenBlob(t,r+"."+o)):s?((n=i.createElement("a")).href=t,n.download=r+"."+o,this.container.appendChild(n),n.click(),n.remove()):e.error("The browser doesn't support downloading files")},e.Chart.prototype.downloadCSV=function(){var e=this.getCSV(!0);this.fileDownload("data:text/csv,\ufeff"+encodeURIComponent(e),"csv",e,"text/csv")},e.Chart.prototype.downloadXLS=function(){var e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Ark1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>td{border:none;font-family: Calibri, sans-serif;} .number{mso-number-format:"0.00";} .text{ mso-number-format:"@";}</style><meta name=ProgId content=Excel.Sheet><meta charset=UTF-8></head><body>'+this.getTable(!0)+"</body></html>";this.fileDownload("data:application/vnd.ms-excel;base64,"+a.btoa(unescape(encodeURIComponent(e))),"xls",e,"application/vnd.ms-excel")},e.Chart.prototype.viewData=function(){this.dataTableDiv||(this.dataTableDiv=i.createElement("div"),this.dataTableDiv.className="highcharts-data-table",this.renderTo.parentNode.insertBefore(this.dataTableDiv,this.renderTo.nextSibling)),this.dataTableDiv.innerHTML=this.getTable()},e.Chart.prototype.openInCloud=function(){var t,o;(function t(o){Object.keys(o).forEach(function(n){"function"==typeof o[n]&&delete o[n],e.isObject(o[n])&&t(o[n])})})(t=e.merge(this.userOptions)),t={name:t.title&&t.title.text||"Chart title",options:t,settings:{constructor:"Chart",dataProvider:{csv:this.getCSV()}}},o=JSON.stringify(t),function(){var e=i.createElement("form");i.body.appendChild(e),e.method="post",e.action="https://cloud-api.highcharts.com/openincloud",e.target="_blank";var t=i.createElement("input");t.type="hidden",t.name="chart",t.value=o,e.appendChild(t),e.submit(),i.body.removeChild(e)}()};var l=e.getOptions().exporting;l&&(e.extend(l.menuItemDefinitions,{downloadCSV:{textKey:"downloadCSV",onclick:function(){this.downloadCSV()}},downloadXLS:{textKey:"downloadXLS",onclick:function(){this.downloadXLS()}},viewData:{textKey:"viewData",onclick:function(){this.viewData()}},openInCloud:{textKey:"openInCloud",onclick:function(){this.openInCloud()}}}),l.buttons.contextButton.menuItems.push("separator","downloadCSV","downloadXLS","viewData","openInCloud")),r.map&&(r.map.prototype.exportKey="name"),r.mapbubble&&(r.mapbubble.prototype.exportKey="name"),r.treemap&&(r.treemap.prototype.exportKey="name")}(e)});
